# Error Codes Reference

> **Auto-generated**: Do not edit manually
> **Generated by**: tools/generate_error_doc.go
> **Last updated**: 2026-02-26

## Overview

This document provides a comprehensive reference of all error codes used in the New API system.

### Error Code Categories

| Category | Range | Description |
|----------|-------|-------------|
| General Errors | 1xxx | General request and validation errors |
| System Errors | 2xxx | Internal system errors |
| Channel Errors | 3xxx | Channel and provider-related errors |
| Client Errors | 4xxx | Client request errors |
| Upstream Errors | 5xxx | Upstream provider errors |
| Database Errors | 6xxx | Database operation errors |
| Quota Errors | 7xxx | Quota and billing errors |

### Error Levels

| Level | Description | Color |
|-------|-------------|-------|
| info | Informational messages | Cyan |
| warning | Warning messages that don't prevent operation | Yellow |
| error | Error events that might allow continuation | Red |
| critical | Critical errors that may cause termination | Magenta |

---


## Channel Errors (3xxx)

| Code | Constant Name | HTTP Status | Level | Description |
|------|---------------|-------------|-------|-------------|
| 3001 | `ErrorCodeChannelNoAvailableKey` | 503 | error | No available API key in channel |
| 3002 | `ErrorCodeChannelParamOverrideInvalid` | 400 | warning | Invalid channel parameter override |
| 3003 | `ErrorCodeChannelHeaderOverrideInvalid` | 400 | warning | Invalid channel header override |
| 3004 | `ErrorCodeChannelModelMappedError` | 500 | error | Channel model mapping error |
| 3005 | `ErrorCodeChannelAwsClientError` | 500 | error | AWS client configuration error |
| 3006 | `ErrorCodeChannelInvalidKey` | 401 | warning | Invalid channel API key |
| 3007 | `ErrorCodeChannelResponseTimeExceeded` | 504 | warning | Channel response time exceeded |
| 3008 | `ErrorCodeChannelNotAvailable` | 503 | critical | Channel is not available |


---


## Client Errors (4xxx)

| Code | Constant Name | HTTP Status | Level | Description |
|------|---------------|-------------|-------|-------------|
| 4001 | `ErrorCodeReadRequestBodyFailed` | 400 | warning | Failed to read request body |
| 4002 | `ErrorCodeConvertRequestFailed` | 400 | warning | Failed to convert request format |
| 4003 | `ErrorCodeAccessDenied` | 401 | warning | Access denied |
| 4004 | `ErrorCodeBadRequestBody` | 400 | warning | Invalid request body |
| 4005 | `ErrorCodeUnauthorized` | 401 | warning | Unauthorized access |
| 4006 | `ErrorCodeForbidden` | 403 | warning | Forbidden |


---


## Database Errors (6xxx)

| Code | Constant Name | HTTP Status | Level | Description |
|------|---------------|-------------|-------|-------------|
| 6001 | `ErrorCodeQueryDataError` | 500 | critical | Database query error |
| 6002 | `ErrorCodeUpdateDataError` | 500 | critical | Database update error |
| 6003 | `ErrorCodeInsertDataError` | 500 | critical | Database insert error |
| 6004 | `ErrorCodeDeleteDataError` | 500 | critical | Database delete error |
| 6005 | `ErrorCodeDatabaseConnectionFailed` | 500 | critical | Database connection failed |


---


## General Errors (1xxx)

| Code | Constant Name | HTTP Status | Level | Description |
|------|---------------|-------------|-------|-------------|
| 1001 | `ErrorCodeInvalidRequest` | 400 | warning | Invalid request parameters |
| 1002 | `ErrorCodeSensitiveWordsDetected` | 400 | warning | Sensitive words detected in content |


---


## Quota Errors (7xxx)

| Code | Constant Name | HTTP Status | Level | Description |
|------|---------------|-------------|-------|-------------|
| 7001 | `ErrorCodeInsufficientUserQuota` | 402 | warning | Insufficient user quota |
| 7002 | `ErrorCodePreConsumeTokenQuotaFailed` | 500 | error | Failed to pre-consume token quota |
| 7003 | `ErrorCodeQuotaExceeded` | 402 | warning | User quota exceeded |


---


## System Errors (2xxx)

| Code | Constant Name | HTTP Status | Level | Description |
|------|---------------|-------------|-------|-------------|
| 2001 | `ErrorCodeCountTokenFailed` | 500 | error | Failed to count tokens |
| 2002 | `ErrorCodeModelPriceError` | 500 | error | Model pricing configuration error |
| 2003 | `ErrorCodeInvalidApiType` | 400 | error | Invalid API type |
| 2004 | `ErrorCodeJsonMarshalFailed` | 500 | error | Failed to marshal JSON |
| 2005 | `ErrorCodeJsonUnmarshalFailed` | 500 | error | Failed to unmarshal JSON |
| 2006 | `ErrorCodeDoRequestFailed` | 500 | error | Failed to make HTTP request |
| 2007 | `ErrorCodeGetChannelFailed` | 500 | critical | Failed to get channel information |
| 2008 | `ErrorCodeGenRelayInfoFailed` | 500 | error | Failed to generate relay information |


---


## Upstream Errors (5xxx)

| Code | Constant Name | HTTP Status | Level | Description |
|------|---------------|-------------|-------|-------------|
| 5001 | `ErrorCodeReadResponseBodyFailed` | 500 | error | Failed to read response body |
| 5002 | `ErrorCodeBadResponseStatusCode` | 502 | error | Bad response status code from upstream |
| 5003 | `ErrorCodeBadResponse` | 502 | error | Bad response from upstream service |
| 5004 | `ErrorCodeBadResponseBody` | 500 | error | Invalid response body format |
| 5005 | `ErrorCodeEmptyResponse` | 500 | error | Empty response from upstream |
| 5006 | `ErrorCodeAwsInvokeError` | 500 | error | AWS invocation error |
| 5007 | `ErrorCodeModelNotFound` | 404 | warning | Model not found |
| 5008 | `ErrorCodePromptBlocked` | 400 | warning | Prompt blocked by content filter |
| 5009 | `ErrorCodeRateLimitExceeded` | 429 | warning | Rate limit exceeded |
| 5010 | `ErrorCodeServiceUnavailable` | 503 | critical | Service temporarily unavailable |


---



## Usage Examples

### Creating an Error

```go
import "github.com/QuantumNous/new-api/types"

// Create error with automatic status code and level
err := types.NewError(
    errors.New("channel not available"),
    types.ErrorCodeChannelNoAvailableKey,
)

// Access error properties
fmt.Println(err.StatusCode)        // 503
fmt.Println(err.Level)             // error
fmt.Println(err.errorCode.String()) // "channel_no_available_key"
```

### Localized Error Messages

```go
// Get localized error message
lang := types.GetLanguageFromContext("zh-CN")
message := err.Localize(lang)
// Returns: "渠道不可用"
```

### Custom Error Level

```go
// Override default error level
err := types.NewError(
    errors.New("custom error"),
    types.ErrorCodeInvalidRequest,
    types.ErrOptionWithLevel(types.ErrorLevelCritical),
)
```

### Error Handling in Controllers

```go
func Relay(c *gin.Context) {
    // ... business logic ...
    if err != nil {
        newApiErr := types.NewError(err, types.ErrorCodeInvalidRequest)
        c.JSON(newApiErr.StatusCode, gin.H{
            "error": newApiErr.ToOpenAIError(),
        })
        return
    }
}
```

## HTTP Status Code Mapping

All error codes automatically map to appropriate HTTP status codes:

- **400 Bad Request**: Invalid request parameters, malformed request body
- **401 Unauthorized**: Invalid or missing authentication
- **403 Forbidden**: Access denied
- **404 Not Found**: Model or resource not found
- **402 Payment Required**: Insufficient quota
- **429 Too Many Requests**: Rate limit exceeded
- **500 Internal Server Error**: Internal system errors
- **502 Bad Gateway**: Invalid response from upstream
- **503 Service Unavailable**: No available channels
- **504 Gateway Timeout**: Response time exceeded

## Migration from Legacy Error Codes

If you're migrating from the old string-based error codes:

```go
// Old (deprecated)
types.ErrorCodeChannelNoAvailableKey  // "channel:no_available_key"

// New (numeric)
types.ErrorCodeChannelNoAvailableKey  // 3001
```

The constant names remain the same, but the type changed from string to int.
This provides better type safety and performance.

## See Also

- [Error Handling Improvements Proposal](./error-code-improvements.md)
- [types/error.go](../types/error.go) - Error implementation
- [types/error_code.go](../types/error_code.go) - Error code definitions
- [types/error_level.go](../types/error_level.go) - Error level definitions
- [types/error_i18n.go](../types/error_i18n.go) - Internationalization support

---

**Total Error Codes**: 42
**Last Modified**: 2026-02-26
